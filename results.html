<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="R√©sultats du quiz secouriste">
    <title>R√©sultats | Quiz Secouriste Suisse</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23E30613' width='100' height='100' rx='15'/><text x='50' y='68' font-size='50' text-anchor='middle' fill='white'>+</text></svg>">
</head>
<body>
    <div class="page-wrapper">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <a href="index.html" class="logo">
                        <div class="logo-icon"></div>
                        <div class="logo-text">Quiz<span>Secouriste</span>.ch</div>
                    </a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main>
            <div class="container">
                <div class="results-card" id="results-container">
                    <!-- Results rendered by JavaScript -->
                    <div style="text-align: center; padding: 2rem;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
                        <p>Chargement des r√©sultats...</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <p class="footer-text">
                        ¬© 2025 Quiz Secouriste Suisse ‚Äî Outil de formation non officiel
                    </p>
                    <div class="footer-links">
                        <a href="https://www.resuscitation.ch" target="_blank" rel="noopener">SRC</a>
                        <a href="https://www.ivr-ias.ch" target="_blank" rel="noopener">IAS</a>
                        <a href="https://www.samariter.ch" target="_blank" rel="noopener">SSS</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('results-container');
            const resultsData = sessionStorage.getItem('quizResults');

            if (!resultsData) {
                container.innerHTML = `
                    <div class="results-icon failure">üòï</div>
                    <h1 class="results-title">Aucun r√©sultat</h1>
                    <p class="results-subtitle">Vous n'avez pas encore compl√©t√© de quiz.</p>
                    <div class="results-actions">
                        <a href="index.html" class="btn btn-primary btn-lg">Commencer un quiz</a>
                    </div>
                `;
                return;
            }

            const results = JSON.parse(resultsData);
            const { level, levelInfo, totalQuestions, score, answers, percentage, passed } = results;

            // Generate breakdown HTML
            let breakdownHTML = '';
            answers.forEach((answer, index) => {
                const statusClass = answer.result;
                const statusIcon = {
                    correct: '‚úì',
                    partial: '‚óê',
                    incorrect: '‚úó'
                }[answer.result];

                breakdownHTML += `
                    <div class="breakdown-item ${statusClass}">
                        <span class="breakdown-number">${index + 1}</span>
                        <span class="breakdown-text">${truncateText(answer.question, 80)}</span>
                        <span style="margin-left: auto; font-weight: 600;">${statusIcon}</span>
                    </div>
                `;
            });

            // Messages based on score
            let message = '';
            let emoji = '';
            if (percentage >= 90) {
                message = 'Excellent ! Vous ma√Ætrisez parfaitement ce niveau.';
                emoji = 'üèÜ';
            } else if (percentage >= 80) {
                message = 'Bravo ! Vous avez valid√© ce niveau avec succ√®s.';
                emoji = 'üéâ';
            } else if (percentage >= 60) {
                message = 'Pas mal ! Quelques r√©visions et vous y √™tes.';
                emoji = 'üìö';
            } else {
                message = 'Continuez √† vous entra√Æner, vous progresserez !';
                emoji = 'üí™';
            }

            container.innerHTML = `
                <div class="results-icon ${passed ? 'success' : 'failure'}">${emoji}</div>
                <h1 class="results-title">${passed ? 'Quiz r√©ussi !' : 'Quiz non valid√©'}</h1>
                <p class="results-subtitle">${message}</p>

                <div class="results-score">
                    <div class="score-item">
                        <div class="score-value percentage">${percentage}%</div>
                        <div class="score-label">Score global</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value correct">${score.correct}</div>
                        <div class="score-label">Bonnes r√©ponses</div>
                    </div>
                    <div class="score-item">
                        <div class="score-value incorrect">${score.incorrect}</div>
                        <div class="score-label">Erreurs</div>
                    </div>
                </div>

                <div style="background: var(--gray-100); padding: var(--space-md); border-radius: var(--radius-lg); margin-bottom: var(--space-xl);">
                    <span class="quiz-level-badge ${levelInfo.class}">
                        ${levelInfo.icon} Niveau ${level}: ${levelInfo.name}
                    </span>
                    <span style="margin-left: var(--space-md); color: var(--gray-600);">
                        ${totalQuestions} questions ‚Ä¢ Seuil de r√©ussite: 80%
                    </span>
                </div>

                <div class="results-breakdown">
                    <h3 class="breakdown-title">D√©tail des r√©ponses</h3>
                    <div class="breakdown-list" style="max-height: 400px; overflow-y: auto;">
                        ${breakdownHTML}
                    </div>
                </div>

                <div class="results-actions">
                    <a href="quiz.html?niveau=${level}" class="btn btn-outline">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 4v6h6M23 20v-6h-6"/>
                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                        </svg>
                        Recommencer ce niveau
                    </a>
                    <a href="index.html" class="btn btn-primary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9 22 9 12 15 12 15 22"/>
                        </svg>
                        Retour √† l'accueil
                    </a>
                </div>
            `;

            // Clear results from storage
            // sessionStorage.removeItem('quizResults');
        });

        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }
    </script>
</body>
</html>
